@startuml
title IaC + IaaS + SDI (GPU Analytics)

skinparam componentStyle rectangle
skinparam shadowing false

package "IaC" as IAC {
  component TF as "Terraform"
  component PKR as "Packer"
  component ANS as "Ansible"
  component GIT as "Helm/ArgoCD"
}

package "IaaS (AWS)" as IAAS {
  node VPC as "VPC/Subnets/SG"
  node EKS as "EKS"
  node GGPU as "EC2 GPU ASG"
  node GNODE as "EC2 General ASG"
  node MSK as "MSK or EC2 Kafka"
  database STOR as "EBS/EFS/FSx"
}

package "SDI (Kubernetes)" as SDI {
  node K8S as "Kubernetes Cluster" {
    component GPUOP as "GPU Operator"
    component STRZ as "Strimzi"
    component MOP as "Mongo Operator"
    component AUTO as "Autoscaler"
  }
}

package "Apps/Data" as APP {
  node PROD as "GPU Producer"
  node KAF as "Kafka"
  node PROC as "Processor"
  database MONGO as "MongoDB"
}

' IaC provisions
TF --> VPC : provision
TF --> EKS
TF --> GGPU
TF --> GNODE
TF --> STOR
TF --> MSK
PKR --> GGPU : AMI
ANS --> GGPU : converge
GIT --> K8S : sync

' IaaS->SDI hosts
EKS -- K8S
GGPU -- K8S
GNODE -- K8S

' Operators
K8S -- GPUOP
K8S -- STRZ
K8S -- MOP
K8S -- AUTO

' App flow
GPUOP -- PROD : schedule
STRZ -- KAF : manage
MOP -- MONGO : manage
PROD --> KAF : publish
KAF --> PROC : consume
PROC --> MONGO : write

' Scaling/backpressure
PROC --> AUTO : lag
AUTO ..> GGPU : add/remove
AUTO ..> GNODE : add/remove
@enduml
